# üß≠ –§–∏–ª—å—Ç—Ä –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –≤–µ—Å–ª–∞

## üìã –û–±–∑–æ—Ä

`RelativeOrientationFilter` - —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–µ—Å–ª–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞—è–∫–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π:

- ‚úÖ **DMP –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã** (–≥–∏—Ä–æ—Å–∫–æ–ø + –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä) - –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä—ã** - –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥—Ä–∏—Ñ—Ç–∞ yaw (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–º–µ—Ö)
- ‚úÖ **–¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å –≥—Ä–µ–±–ª–∏** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –≤ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∑–∞—Ö
- ‚úÖ **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –¥–æ–≤–µ—Ä–∏–µ** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –¥–∞—Ç—á–∏–∫–æ–≤

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –î–µ—Ç–µ–∫—Ü–∏—è –º–∞–≥–Ω–∏—Ç–Ω—ã—Ö –ø–æ–º–µ—Ö

–§–∏–ª—å—Ç—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ –ø–æ —Ç—Ä–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:

```cpp
// –í–µ–ª–∏—á–∏–Ω–∞ –º–∞–≥–Ω–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ~50 ŒºT)
float magnitudeDeviation = abs(stats.magnitude - 50.0f) / 50.0f;
if (magnitudeDeviation > 0.30f) { // –±–æ–ª–µ–µ 30% –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
    trust *= 0.5f; // —Å–Ω–∏–∂–∞–µ–º –¥–æ–≤–µ—Ä–∏–µ
}

// –°–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 ŒºT/s)
if (stats.changeRate > 100.0f) {
    trust *= 0.3f; // –º–∞–≥–Ω–∏—Ç–Ω–∞—è –ø–æ–º–µ—Ö–∞!
}

// –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏–π)
if (stats.consistency < 0.7f) {
    trust *= 0.5f;
}
```

### 2. –§–∞–∑—ã –≥—Ä–µ–±–∫–∞

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç 4 —Ñ–∞–∑—ã:

| –§–∞–∑–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –£—Å–ª–æ–≤–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
|------|----------|-------------------|
| **CATCH** | –ó–∞—Ö–≤–∞—Ç –≤–æ–¥—ã | `shaftTilt < -20¬∞` + `force > 300` |
| **PULL** | –¢—è–≥–∞ | `force > 600` |
| **RELEASE** | –í—ã—Ö–æ–¥ –∏–∑ –≤–æ–¥—ã | `shaftTilt > 20¬∞` + –ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ PULL |
| **RECOVERY** | –ü—Ä–æ–≤–æ–¥–∫–∞ –≤ –≤–æ–∑–¥—É—Ö–µ | `force < 200` |

### 3. –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–∑–∞—Ö (CATCH, RELEASE) —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–µ—Å–ª–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏:

```cpp
// –û–±—É—á–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ–º—ã—Ö –ø–æ–ª–æ–∂–µ–Ω–∏–π
if (currentPhase == StrokePhase::CATCH && lastPhase != StrokePhase::CATCH) {
    expectedCatchQuat = currentQuat.slerp(expectedCatchQuat, 0.05f);
}
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```cpp
// –í setup()
FilterParameters params;

// –î–æ–≤–µ—Ä–∏–µ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö
params.gyroTrust = 0.98f;        // 98% –¥–æ–≤–µ—Ä–∏–µ DMP (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–µ!)
params.magTrustMax = 0.02f;      // –ú–∞–∫—Å–∏–º—É–º 2% –¥–ª—è –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞
params.magTrustMin = 0.0f;       // –ú–∏–Ω–∏–º—É–º 0% (–ø—Ä–∏ –ø–æ–º–µ—Ö–∞—Ö)

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø–æ–º–µ—Ö
params.nominalMagMagnitude = 50.0f;  // ŒºT –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ!)
params.magTolerancePercent = 30.0f;  // ¬±30% –¥–æ–ø—É—Å–∫
params.maxMagChangeRate = 100.0f;    // ŒºT/s –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

// –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ —Ñ–∞–∑–∞–º –≥—Ä–µ–±–ª–∏
params.useStrokePhaseCorrection = true;
params.strokePhaseWeight = 0.1f;     // 10% –≤–ª–∏—è–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏

kayak.getOrientationFilter().setParameters(params);
```

### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–∏–ª—É –º–∞–≥–Ω–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è –ó–µ–º–ª–∏** –¥–ª—è –≤–∞—à–µ–π –ª–æ–∫–∞—Ü–∏–∏:
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [NOAA Magnetic Field Calculator](https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml)
   - –ò–ª–∏ –∏–∑–º–µ—Ä—å—Ç–µ –≤ —á–∏—Å—Ç–æ–º –º–µ—Å—Ç–µ (–≤–¥–∞–ª–∏ –æ—Ç –º–µ—Ç–∞–ª–ª–∞)

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–æ–º–∏–Ω–∞–ª—å–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É**:
```cpp
params.nominalMagMagnitude = 48.5f; // –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —à–∏—Ä–æ—Ç
```

3. **–û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –¥–æ–ø—É—Å–∫** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏–π:
   - –ú–æ—Ä–µ, –æ—Ç–∫—Ä—ã—Ç–∞—è –≤–æ–¥–∞: `20-30%`
   - –†–µ–∫–∞ —Å –º–æ—Å—Ç–∞–º–∏: `40-50%`
   - –ì–æ—Ä–æ–¥—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è: `60%+` (–∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä)

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥

### –í SmartKayak.cpp

```cpp
void SmartKayak::update() {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–æ–≤
    IMUData kayakIMU;
    imu->getData(kayakIMU);
    IMUData paddleIMU = paddle->getIMUData();
    
    SP_Math::Vector kayakMag(kayakIMU.mag_x, kayakIMU.mag_y, kayakIMU.mag_z);
    SP_Math::Vector paddleMag(paddleIMU.mag_x, paddleIMU.mag_y, paddleIMU.mag_z);
    
    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∞–∑—ã
    float shaftAngle, shaftTilt, bladeAngle;
    getPaddleAngles(currentPaddleQ, kayakOrientationQuat, 
                    shaftAngle, shaftTilt, bladeAngle);
    
    // –û–°–ù–û–í–ù–û–ô –í–´–ó–û–í –§–ò–õ–¨–¢–†–ê
    SP_Math::Quaternion paddleRelativeQuat = orientationFilter.update(
        kayakOrientationQuat,  // –ö–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω –∫–∞—è–∫–∞
        currentPaddleQ,         // –ö–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω –≤–µ—Å–ª–∞
        kayakMag,               // –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –∫–∞—è–∫–∞
        paddleMag,              // –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –≤–µ—Å–ª–∞
        shaftAngle,             // –£–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≤–µ—Å–ª–∞
        bladeForce              // –°–∏–ª–∞ –Ω–∞ –ª–æ–ø–∞—Å—Ç–∏
    );
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
    getPaddleAngles(paddleRelativeQuat, shaftAngle, shaftTilt, bladeAngle);
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–æ–≤

```cpp
void SmartKayak::logDebugInfo() {
    bool kayakMagOK = orientationFilter.isKayakMagReliable();
    bool paddleMagOK = orientationFilter.isPaddleMagReliable();
    
    Serial.printf("Mag Status: Kayak=%s, Paddle=%s\n",
        kayakMagOK ? "‚úì" : "‚úó",
        paddleMagOK ? "‚úì" : "‚úó"
    );
    
    float yawCorrection = orientationFilter.getYawDriftCorrection();
    Serial.printf("Yaw drift correction: %.2f¬∞\n", yawCorrection * RAD_TO_DEG);
    
    StrokePhase phase = orientationFilter.getCurrentPhase();
    Serial.printf("Stroke phase: %d\n", (int)phase);
}
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Serial Plotter

```cpp
void SmartKayak::logForPlotter() {
    MagnetometerStats kayakStats = orientationFilter.getKayakMagStats();
    
    // –§–æ—Ä–º–∞—Ç: magnitude, changeRate, consistency, trust
    Serial.printf("%.1f,%.1f,%.2f,%d\n",
        kayakStats.magnitude,
        kayakStats.changeRate,
        kayakStats.consistency,
        kayakStats.isReliable ? 100 : 0
    );
}
```

## üéì –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–∞

```
DMP Quaternions (98% trust)
        ‚Üì
    [Base Relative Orientation]
        ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ[Magnetometer Correction]‚Üê‚îÄ‚îÄ Adaptive trust (0-2%)
    ‚îÇ       ‚Üì
    ‚îÇ   [Stroke Phase Correction]‚Üê‚îÄ‚îÄ Pattern matching
    ‚îÇ       ‚Üì
    ‚îî‚Üí [Complementary Filter] ‚Üí Output
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏** –∏–∑ DMP –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω–æ–≤
   - –ü—Ä–æ–µ—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø–ª–æ—Å–∫–æ—Å—Ç—å
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞—è–∫–∞

2. **–û—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–ª–∏—á–∏–Ω—ã –ø–æ–ª—è
   - –ê–Ω–∞–ª–∏–∑ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –û—Ü–µ–Ω–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è yaw**
   - –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –Ω–∞–¥–µ–∂–µ–Ω
   - –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É—Ä–æ–≤–Ω—é –¥–æ–≤–µ—Ä–∏—è
   - –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

4. **–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –≥—Ä–µ–±–ª–∏**
   - –û–±—É—á–µ–Ω–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏–π –≤ CATCH/RELEASE
   - –°–ª–∞–±–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è (10%) –∫ –æ–∂–∏–¥–∞–µ–º—ã–º –ø–æ–∑–∏—Ü–∏—è–º
   - –°–∏–ª—å–Ω–µ–µ –≤ —Ñ–∞–∑–µ RECOVERY (–≤–µ—Å–ª–æ –≤ –≤–æ–∑–¥—É—Ö–µ)

5. **–ö–æ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä**
   - –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - –í—ã—Å–æ–∫–æ–µ –¥–æ–≤–µ—Ä–∏–µ –∫ DMP (98%)
   - –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–π –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏:

1. **–ö–∞–ª–∏–±—Ä—É–π—Ç–µ IMU** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–µ–π
2. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –º–∞–≥–Ω–∏—Ç–Ω–æ–µ –ø–æ–ª–µ** –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
3. **–î–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º–µ "–æ–±—É—á–∏—Ç—å—Å—è"** - –ø–µ—Ä–≤—ã–µ 10-20 –≥—Ä–µ–±–∫–æ–≤ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
4. **–ò–∑–±–µ–≥–∞–π—Ç–µ –º–∞–≥–Ω–∏—Ç–Ω—ã—Ö –ø–æ–º–µ—Ö** - –¥–µ—Ä–∂–∏—Ç–µ—Å—å –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å** –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

**–ß–∏—Å—Ç–∞—è –≤–æ–¥–∞, –Ω–µ—Ç –ø–æ–º–µ—Ö:**
```cpp
params.magTrustMax = 0.05f;  // –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ–≤–µ—Ä–∏–µ –∫ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä—É
```

**–ì–æ—Ä–æ–¥—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è, –º–æ—Å—Ç—ã:**
```cpp
params.magTrustMax = 0.01f;  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞
params.useStrokePhaseCorrection = true;  // –ü–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
```

**–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å):**
```cpp
params.gyroTrust = 0.99f;    // –ü–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ –¥–æ–≤–µ—Ä–∏–µ DMP
params.magTrustMax = 0.0f;   // –û—Ç–∫–ª—é—á–∞–µ–º –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä
params.strokePhaseWeight = 0.15f;  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
```

## üî¨ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

```cpp
void SmartKayak::exportFilterData(File& logFile) {
    logFile.printf("%lu,", millis());
    
    // –ö–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã
    logFile.printf("%.4f,%.4f,%.4f,%.4f,", 
        filteredQuat.w(), filteredQuat.x(), 
        filteredQuat.y(), filteredQuat.z());
    
    // –°—Ç–∞—Ç—É—Å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–æ–≤
    logFile.printf("%d,%d,", 
        orientationFilter.isKayakMagReliable(),
        orientationFilter.isPaddleMagReliable());
    
    // –§–∞–∑–∞ –≥—Ä–µ–±–∫–∞
    logFile.printf("%d\n", (int)orientationFilter.getCurrentPhase());
}
```

## ‚ùì FAQ

**Q: –ü–æ—á–µ–º—É —Ñ–∏–ª—å—Ç—Ä –≤—Å–µ –µ—â–µ –¥—Ä–∏—Ñ—Ç–∏—Ç?**
A: DMP –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã —É–∂–µ –æ—á–µ–Ω—å —Ç–æ—á–Ω—ã. –ù–µ–±–æ–ª—å—à–æ–π –¥—Ä–∏—Ñ—Ç (< 1¬∞/–º–∏–Ω) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏.

**Q: –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–Ω–µ–Ω–∞–¥–µ–∂–µ–Ω"**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `nominalMagMagnitude` –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ –∏ —É–≤–µ–ª–∏—á—å—Ç–µ `magTolerancePercent`.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é?**
A: –î–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `params.magTrustMax = 0.0f`. –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ DMP + –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –≥—Ä–µ–±–ª–∏.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞—Ç—å update()?**
A: –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º IMU –¥–∞–Ω–Ω—ã—Ö, –æ–±—ã—á–Ω–æ 50-100 Hz.

---

**–ê–≤—Ç–æ—Ä:** SmartKayak Team  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-16
