# üéØ –°–∏—Å—Ç–µ–º–∞ –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –≤–µ—Å–ª–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞—è–∫–∞

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–æ–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
3. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
4. [–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–ø–æ–¥—Ä–æ–±–Ω–∞—è-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
5. [–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞](#–∫–∞–ª–∏–±—Ä–æ–≤–∫–∞-–º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞)
6. [–¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—Ç–æ–Ω–∫–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
7. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–∏-–æ—Ç–ª–∞–¥–∫–∞)
8. [FAQ](#faq)

---

## üîç –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
- ‚úÖ –ï—Å—Ç—å IMU –¥–∞—Ç—á–∏–∫–∏ –Ω–∞ –≤–µ—Å–ª–µ –∏ –∫–∞—è–∫–µ (–∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä, –≥–∏—Ä–æ—Å–∫–æ–ø, –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä)
- ‚úÖ –ï—Å—Ç—å DMP –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã (—Ñ—É–∑–∏—è –≥–∏—Ä–æ—Å–∫–æ–ø–∞ –∏ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞)
- ‚úÖ –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞
- ‚ùå **–ù–û**: –î–∞–Ω–Ω—ã–µ –∏–Ω–æ–≥–¥–∞ –Ω–µ–≤–µ—Ä–Ω—ã –∏–∑-–∑–∞ –º–∞–≥–Ω–∏—Ç–Ω—ã—Ö –ø–æ–º–µ—Ö
- ‚ùå –ì–∏—Ä–æ—Å–∫–æ–ø –¥—Ä–∏—Ñ—Ç—É–µ—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
- ‚ùå –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –∏—Å–∫–∞–∂–∞–µ—Ç—Å—è –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –∫–∞—è–∫–∞/–º–æ—Ç–æ—Ä–∞

### –¶–µ–ª—å:
–ü–æ–ª—É—á–∏—Ç—å **–≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—É—é –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –≤–µ—Å–ª–∞** –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞—è–∫–∞, –∫–æ—Ç–æ—Ä–∞—è:
- üéØ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞–≥–Ω–∏—Ç–Ω—ã—Ö –ø–æ–º–µ—Ö
- üîÑ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é –ø—Ä–∏—Ä–æ–¥—É –≥—Ä–µ–±–ª–∏
- üßÆ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã
- üìä –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –¥—Ä–∏—Ñ—Ç –≥–∏—Ä–æ—Å–∫–æ–ø–∞ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –¥–≤–∏–∂–µ–Ω–∏—è

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  HybridOrientationEstimator                  ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   –ú–∞–≥–Ω–∏—Ç–Ω–∞—è   ‚îÇ  ‚îÇ   –î–µ—Ç–µ–∫—Ü–∏—è   ‚îÇ  ‚îÇ   –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   –∞–Ω–æ–º–∞–ª–∏—è    ‚îÇ‚Üí ‚îÇ     —Ñ–∞–∑      ‚îÇ‚Üí ‚îÇ    –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   –¥–µ—Ç–µ–∫—Ç–æ—Ä    ‚îÇ  ‚îÇ    –≥—Ä–µ–±–∫–∞    ‚îÇ  ‚îÇ     –≥—Ä–µ–±–ª–∏       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ          –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ñ—É–∑–∏—è –¥–∞—Ç—á–∏–∫–æ–≤                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  DMP (98%) + –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä (0-40%) + –ü–∞—Ç—Ç–µ—Ä–Ω—ã (0-30%)   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           MagnetometerCalibrator (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)              ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚Ä¢ Hard Iron –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –º–∞–≥–Ω–∏—Ç—ã)               ‚îÇ
‚îÇ  ‚Ä¢ Soft Iron –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (—Ñ–µ—Ä—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã)         ‚îÇ
‚îÇ  ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

1. **–û—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞** (–∫–∞–∂–¥—ã–π —Ü–∏–∫–ª):
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–≥–Ω–∏—Ç—É–¥—ã –ø–æ–ª—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ~50 ŒºT)
   - –ê–Ω–∞–ª–∏–∑ –≤–∞—Ä–∏–∞—Ü–∏–∏ (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)
   - –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π

2. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ñ—É–∑–∏—è** (–≤–µ—Å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ –º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏):
   ```
   –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å > 70% ‚Üí –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä 40%, –∫–æ—Ä—Ä–µ–∫—Ü–∏—è yaw –∞–∫—Ç–∏–≤–Ω–∞
   –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å 30-70% ‚Üí –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä 10-40%, —á–∞—Å—Ç–∏—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è
   –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å < 30% ‚Üí –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä 0%, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã
   ```

3. **–î–µ—Ç–µ–∫—Ü–∏—è —Ñ–∞–∑—ã –≥—Ä–µ–±–∫–∞**:
   - CATCH (–∑–∞—Ö–≤–∞—Ç) - –≤–µ—Å–ª–æ –≤—Ö–æ–¥–∏—Ç –≤ –≤–æ–¥—É
   - PULL (–ø—Ä–æ–≤–æ–¥–∫–∞) - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç—è–≥–∞
   - RELEASE (–≤—ã—Ö–æ–¥) - –≤–µ—Å–ª–æ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –≤–æ–¥—ã
   - RECOVERY (–≤–æ–∑–≤—Ä–∞—Ç) - –≤–µ—Å–ª–æ –Ω–∞–¥ –≤–æ–¥–æ–π

4. **–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥—Ä–∏—Ñ—Ç–∞**:
   - –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–∏–ø–∏—á–Ω—ã—Ö —É–≥–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–æ–≥–∏—á–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏
   - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è yaw –¥–æ ¬±15¬∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç:

```cpp
// –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ lib/SmartKayak/:
// - HybridOrientationEstimator.h
// - HybridOrientationEstimator.cpp
// - MagnetometerCalibrator.h (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
// - MagnetometerCalibrator.cpp (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ SmartKayak.h:

```cpp
#include "HybridOrientationEstimator.h"
#include "MagnetometerCalibrator.h"  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

class SmartKayak {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
private:
    HybridOrientationEstimator orientationEstimator;
    MagnetometerCalibrator magCalibrator;  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
};
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:

```cpp
SmartKayak::SmartKayak() : /* ... */ {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –æ—Ü–µ–Ω—â–∏–∫–∞
    orientationEstimator.setFilterWeights(
        0.98f,  // gyro (–∏–∑ DMP)
        0.02f,  // accel (–∏–∑ DMP)
        0.3f,   // mag (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)
        0.2f    // pattern (–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º)
    );
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ –∞–Ω–æ–º–∞–ª–∏–π
    MagneticAnomalyDetector detector;
    detector.varianceThreshold = 40.0f;  // –¥–ª—è –≤–æ–¥—ã —Å –≤–æ–ª–Ω–∞–º–∏
    detector.magnitudeMin = 30.0f;
    detector.magnitudeMax = 70.0f;
    orientationEstimator.setAnomalyDetector(detector);
}
```

### 4. –ó–∞–º–µ–Ω–∞ –≤ –º–µ—Ç–æ–¥–µ update():

**–ë–´–õ–û:**
```cpp
SP_Math::Quaternion currentPaddleQ(paddleOrientation.q0, ...);
SP_Math::Quaternion paddleRelativeQuat = getRelativeOrientation(currentPaddleQ, paddle);
```

**–°–¢–ê–õ–û:**
```cpp
IMUData paddleIMU = paddle->getIMUData();
IMUData kayakIMU;
imu->getData(kayakIMU);

OrientationData kayakOrientation;
kayakOrientation.q0 = kayakOrientationQuat[0];
kayakOrientation.q1 = kayakOrientationQuat[1];
kayakOrientation.q2 = kayakOrientationQuat[2];
kayakOrientation.q3 = kayakOrientationQuat[3];

// –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é
SP_Math::Quaternion paddleRelativeQuat = 
    orientationEstimator.updateRelativeOrientation(
        paddleIMU,           // IMU –≤–µ—Å–ª–∞
        paddleOrientation,   // DMP –≤–µ—Å–ª–∞
        kayakIMU,           // IMU –∫–∞—è–∫–∞
        kayakOrientation    // DMP –∫–∞—è–∫–∞
    );
```

### 5. –î–µ—Ç–µ–∫—Ü–∏—è —Ñ–∞–∑—ã –≥—Ä–µ–±–∫–∞ (–¥–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≥–ª–æ–≤):

```cpp
float shaftRotationAngle, shaftTiltAngle, bladeRotationAngle;
getPaddleAngles(paddleRelativeQuat, shaftRotationAngle, shaftTiltAngle, bladeRotationAngle);

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–∑—É –≥—Ä–µ–±–∫–∞
StrokePhase::Phase currentPhase = orientationEstimator.detectStrokePhase(
    shaftRotationAngle,
    shaftTiltAngle,
    bladeForce  // –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å–∏–ª—ã
);
```

---

## üìê –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ HybridOrientationEstimator)

```cpp
// –í SmartKayak.cpp, –º–µ—Ç–æ–¥ update():

void SmartKayak::update() {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ...
    
    OrientationData paddleOrientation = paddle->getOrientationData();
    if (paddleOrientation.q0 == 0 && /* ... */) return;
    
    // –ù–û–í–´–ô –ö–û–î
    IMUData paddleIMU = paddle->getIMUData();
    IMUData kayakIMU;
    imu->getData(kayakIMU);
    
    OrientationData kayakOrientation;
    kayakOrientation.q0 = kayakOrientationQuat[0];
    kayakOrientation.q1 = kayakOrientationQuat[1];
    kayakOrientation.q2 = kayakOrientationQuat[2];
    kayakOrientation.q3 = kayakOrientationQuat[3];
    
    SP_Math::Quaternion paddleRelativeQuat = 
        orientationEstimator.updateRelativeOrientation(
            paddleIMU, paddleOrientation,
            kayakIMU, kayakOrientation
        );
    
    // ... –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ ...
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–ø–∞—Å—Ç—å
    BladeSideType bladeSide = getLowerBladeSide(
        SP_Math::Quaternion(paddleOrientation.q0, paddleOrientation.q1, 
                           paddleOrientation.q2, paddleOrientation.q3),
        paddle->getBladeAngles().YAxisDirection
    );
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞

```cpp
// –í SmartKayak.h –¥–æ–±–∞–≤—å—Ç–µ:
class SmartKayak {
private:
    HybridOrientationEstimator orientationEstimator;
    MagnetometerCalibrator paddleMagCalibrator;
    MagnetometerCalibrator kayakMagCalibrator;
    MagneticInterferenceDetector interferenceDetector;
    
public:
    void startMagnetometerCalibration(bool isPaddle = true);
    void stopMagnetometerCalibration(bool isPaddle = true);
};

// –í SmartKayak.cpp:

void SmartKayak::startMagnetometerCalibration(bool isPaddle) {
    if (isPaddle) {
        paddleMagCalibrator.startCalibration();
        Serial.println("üß≠ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ –í–ï–°–õ–ê");
        Serial.println("   –ú–µ–¥–ª–µ–Ω–Ω–æ –≤—Ä–∞—â–∞–π—Ç–µ –≤–µ—Å–ª–æ –≤–æ –≤—Å–µ—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö");
    } else {
        kayakMagCalibrator.startCalibration();
        Serial.println("üß≠ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ –ö–ê–Ø–ö–ê");
        Serial.println("   –ú–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –∫–∞—è–∫ (360¬∞)");
    }
}

void SmartKayak::update() {
    // ... –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ...
    
    IMUData paddleIMU = paddle->getIMUData();
    IMUData kayakIMU;
    imu->getData(kayakIMU);
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–∞–ª–∏–±—Ä–æ–≤–∫—É, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
    if (paddleMagCalibrator.isCalibrationValid()) {
        paddleMagCalibrator.applyCalibration(paddleIMU);
    }
    if (kayakMagCalibrator.isCalibrationValid()) {
        kayakMagCalibrator.applyCalibration(kayakIMU);
    }
    
    // –°–±–æ—Ä –æ–±—Ä–∞–∑—Ü–æ–≤ –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ (–µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞)
    if (paddleMagCalibrator.isCalibrationActive()) {
        paddleMagCalibrator.addSample(paddleIMU);
    }
    if (kayakMagCalibrator.isCalibrationActive()) {
        kayakMagCalibrator.addSample(kayakIMU);
    }
    
    // –ê–Ω–∞–ª–∏–∑ –ø–æ–º–µ—Ö
    auto interferenceReport = interferenceDetector.analyze(paddleIMU);
    if (interferenceReport.actionRequired) {
        Serial.printf("‚ö†Ô∏è  –ú–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–º–µ—Ö–∏: %s\n", 
                     interferenceReport.description.c_str());
    }
    
    // –ì–∏–±—Ä–∏–¥–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
    SP_Math::Quaternion paddleRelativeQuat = 
        orientationEstimator.updateRelativeOrientation(
            paddleIMU, paddleOrientation,
            kayakIMU, kayakOrientation
        );
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

---

## üß≠ –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞?

- ‚úÖ –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–º–æ—Ç–æ—Ä—ã, –±–∞—Ç–∞—Ä–µ–∏)
- ‚úÖ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞—è–∫–∞
- ‚úÖ –ï—Å–ª–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ < 50%

### –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –≤–µ—Å–ª–∞:

```cpp
// –í –≤–∞—à–µ–º main.cpp –∏–ª–∏ setup():

void calibratePaddleMagnetometer() {
    Serial.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Serial.println("‚ïë  –ö–ê–õ–ò–ë–†–û–í–ö–ê –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê –í–ï–°–õ–ê       ‚ïë");
    Serial.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    
    smartKayak.startMagnetometerCalibration(true);  // true = –≤–µ—Å–ª–æ
    
    Serial.println("\n–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è:");
    Serial.println("1. –ú–µ–¥–ª–µ–Ω–Ω–æ –≤—Ä–∞—â–∞–π—Ç–µ –≤–µ—Å–ª–æ –≤–æ–∫—Ä—É–≥ –æ—Å–∏ —à–∞—Ñ—Ç–∞ (360¬∞)");
    Serial.println("2. –ù–∞–∫–ª–æ–Ω—è–π—Ç–µ –≤–µ—Å–ª–æ –≤–ø–µ—Ä–µ–¥-–Ω–∞–∑–∞–¥");
    Serial.println("3. –î–µ–ª–∞–π—Ç–µ –≤–æ—Å—å–º–µ—Ä–∫–∏ –≤ –≤–æ–∑–¥—É—Ö–µ");
    Serial.println("4. –ò–º–∏—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–µ–±–∫–∏ (–≤—Å–µ —Ñ–∞–∑—ã)");
    Serial.println("\n–í—Ä–µ–º—è: 30-60 —Å–µ–∫—É–Ω–¥");
    Serial.println("–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...\n");
    
    // –ñ–¥–µ–º –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    while (!Serial.available()) {
        smartKayak.update();  // –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑—Ü—ã
        delay(10);
    }
    
    smartKayak.stopMagnetometerCalibration(true);
}
```

### –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –∫–∞—è–∫–∞:

```cpp
void calibrateKayakMagnetometer() {
    Serial.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Serial.println("‚ïë  –ö–ê–õ–ò–ë–†–û–í–ö–ê –ú–ê–ì–ù–ò–¢–û–ú–ï–¢–†–ê –ö–ê–Ø–ö–ê       ‚ïë");
    Serial.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    
    smartKayak.startMagnetometerCalibration(false);  // false = –∫–∞—è–∫
    
    Serial.println("\n–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:");
    Serial.println("1. –ú–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–≤–µ—Ä–Ω–∏—Ç–µ –∫–∞—è–∫ –Ω–∞ 360¬∞ (–ø–æ–ª–Ω—ã–π –∫—Ä—É–≥)");
    Serial.println("2. –ù–∞–∫–ª–æ–Ω–∏—Ç–µ –∫–∞—è–∫ –≤–ø–µ—Ä–µ–¥-–Ω–∞–∑–∞–¥");
    Serial.println("3. –ù–∞–∫–ª–æ–Ω–∏—Ç–µ –∫–∞—è–∫ –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ");
    Serial.println("\n–í—Ä–µ–º—è: 30-60 —Å–µ–∫—É–Ω–¥");
    Serial.println("–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...\n");
    
    while (!Serial.available()) {
        smartKayak.update();
        delay(10);
    }
    
    smartKayak.stopMagnetometerCalibration(false);
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:

–ü–æ—Å–ª–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å—Å—è:
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ > 80%
- ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω—ã –ø–æ –≤—Å–µ–º –æ—Å—è–º > 40 ŒºT
- ‚úÖ –ë–∞–ª–∞–Ω—Å –æ—Å–µ–π (max/min –¥–∏–∞–ø–∞–∑–æ–Ω < 1.5)

---

## ‚öôÔ∏è –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ –º–∞–≥–Ω–∏—Ç–Ω—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π:

```cpp
MagneticAnomalyDetector detector;

// –î–ª—è —Å–ø–æ–∫–æ–π–Ω–æ–π –≤–æ–¥—ã, —Ö–æ—Ä–æ—à–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞:
detector.varianceThreshold = 20.0f;   // ŒºT¬≤ - –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥
detector.magnitudeMin = 40.0f;        // –£–∑–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω
detector.magnitudeMax = 60.0f;
detector.smoothingFactor = 0.9f;      // –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ

// –î–ª—è –≤–æ–ª–Ω, –Ω–µ–∏–¥–µ–∞–ª—å–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞:
detector.varianceThreshold = 50.0f;   // ŒºT¬≤ - –≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥
detector.magnitudeMin = 25.0f;        // –®–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω
detector.magnitudeMax = 75.0f;
detector.smoothingFactor = 0.7f;      // –ú–µ–Ω—å—à–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è

orientationEstimator.setAnomalyDetector(detector);
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞:

```cpp
// –§–æ—Ä–º–∞—Ç: gyro, accel, mag, pattern

// –ü—Ä–æ—Ñ–∏–ª—å 1: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–æ–≤–µ—Ä–∏–µ DMP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
orientationEstimator.setFilterWeights(0.98f, 0.02f, 0.3f, 0.2f);

// –ü—Ä–æ—Ñ–∏–ª—å 2: –ë–æ–ª—å—à–µ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ (–µ—Å–ª–∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –æ—Ç–ª–∏—á–Ω–∞—è)
orientationEstimator.setFilterWeights(0.95f, 0.05f, 0.5f, 0.1f);

// –ü—Ä–æ—Ñ–∏–ª—å 3: –ë–æ–ª—å—à–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–µ—Å–ª–∏ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –Ω–µ–Ω–∞–¥–µ–∂–µ–Ω)
orientationEstimator.setFilterWeights(0.98f, 0.02f, 0.1f, 0.4f);

// –ü—Ä–æ—Ñ–∏–ª—å 4: –ë–µ–∑ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–º–µ—Ö–∏)
orientationEstimator.setFilterWeights(0.98f, 0.02f, 0.0f, 0.5f);
```

### 3. –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–∂–∏–¥–∞–µ–º–∞—è –º–∞–≥–Ω–∏—Ç—É–¥–∞ –ø–æ–ª—è):

```cpp
// –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —à–∏—Ä–æ—Ç—ã:
// –≠–∫–≤–∞—Ç–æ—Ä (0¬∞): ~25-30 ŒºT
// –ú–æ—Å–∫–≤–∞ (55¬∞N): ~50-55 ŒºT
// –ú—É—Ä–º–∞–Ω—Å–∫ (69¬∞N): ~55-60 ŒºT
// –ê–Ω—Ç–∞—Ä–∫—Ç–∏–∫–∞ (90¬∞S): ~65-70 ŒºT

detector.magnitudeMin = 45.0f;  // –ú–æ—Å–∫–≤–∞
detector.magnitudeMax = 60.0f;
```

---

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

```cpp
// –í loop() –¥–æ–±–∞–≤—å—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:

void loop() {
    smartKayak.update();
    
    static unsigned long lastDiag = 0;
    if (millis() - lastDiag > 2000) {  // –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        orientationEstimator.printDiagnostics(&Serial);
        
        Serial.printf("Mag Reliability: %.1f%% - ", 
                     orientationEstimator.getMagReliability() * 100);
        
        if (orientationEstimator.getMagReliability() > 0.7f) {
            Serial.println("‚úÖ –û–¢–õ–ò–ß–ù–û");
        } else if (orientationEstimator.getMagReliability() > 0.4f) {
            Serial.println("‚ö†Ô∏è  –°–†–ï–î–ù–ï");
        } else {
            Serial.println("‚ùå –ü–õ–û–•–û - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã");
        }
        
        Serial.printf("Current Phase: ");
        switch(orientationEstimator.getCurrentPhase()) {
            case StrokePhase::CATCH: Serial.println("üéØ CATCH"); break;
            case StrokePhase::PULL: Serial.println("üí™ PULL"); break;
            case StrokePhase::RELEASE: Serial.println("üöÄ RELEASE"); break;
            case StrokePhase::RECOVERY: Serial.println("üîÑ RECOVERY"); break;
            default: Serial.println("‚ùì UNKNOWN"); break;
        }
        
        lastDiag = millis();
    }
}
```

### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

```cpp
// –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ª–æ–≥ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤:

void logOrientationData() {
    // CSV —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ Python/MATLAB
    Serial.printf("%lu,%.2f,%d,%.2f,", 
        millis(),
        orientationEstimator.getMagReliability(),
        (int)orientationEstimator.getCurrentPhase(),
        orientationEstimator.getPhaseConfidence()
    );
    
    // –î–æ–±–∞–≤—å—Ç–µ –∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω, —É–≥–ª—ã, —Å–∏–ª—É –∏ —Ç.–¥.
}
```

### 3. –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| Mag Reliability –≤—Å–µ–≥–¥–∞ < 30% | –°–∏–ª—å–Ω—ã–µ –ø–æ–º–µ—Ö–∏ –∏–ª–∏ –ø–ª–æ—Ö–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ | –ü–µ—Ä–µ–∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å, —É–≤–µ–ª–∏—á–∏—Ç—å varianceThreshold |
| –§–∞–∑—ã –Ω–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è (UNKNOWN) | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ —É–≥–ª–æ–≤ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ detectStrokePhase |
| –î—Ä–∏—Ñ—Ç yaw | –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä –æ—Ç–∫–ª—é—á–µ–Ω | –£–≤–µ–ª–∏—á–∏—Ç—å magWeight –¥–æ 0.3-0.5 |
| –†–µ–∑–∫–∏–µ —Å–∫–∞—á–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ | –í—ã–±—Ä–æ—Å—ã –≤ –¥–∞–Ω–Ω—ã—Ö | –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä |
| –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ú–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–∏ –≥—Ä–µ–±–∫–æ–≤ | –°–¥–µ–ª–∞—Ç—å 10+ –≥—Ä–µ–±–∫–æ–≤ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |

---

## ‚ùì FAQ

### Q: –ù–∞—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–Ω–∞ —Å–∏—Å—Ç–µ–º–∞?

**A:** –ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–µ –∏ —Ö–æ—Ä–æ—à–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö:
- Yaw (–ø–æ–≤–æ—Ä–æ—Ç): ¬±2-5¬∞ (—Å –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–æ–º), ¬±5-10¬∞ (–±–µ–∑ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞, —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏)
- Pitch/Roll: ¬±1-2¬∞ (DMP –æ—á–µ–Ω—å —Ç–æ—á–µ–Ω)

### Q: –ö–∞–∫ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞?

**A:** 
- –ú–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä: 1 —Ä–∞–∑ –≤ —Å–µ–∑–æ–Ω –∏–ª–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≥—Ä–µ–±–ª–∏: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é —Å–µ—Å—Å–∏—é

### Q: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –±–µ–∑ –º–∞–≥–Ω–∏—Ç–æ–º–µ—Ç—Ä–∞?

**A:** –î–∞! –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—é –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –≥—Ä–µ–±–ª–∏. –¢–æ—á–Ω–æ—Å—Ç—å –±—É–¥–µ—Ç –Ω–∏–∂–µ (~¬±10¬∞ –ø–æ yaw), –Ω–æ –ø—Ä–∏–µ–º–ª–µ–º–∞ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á.

### Q: –ö–∞–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?

**A:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∞—Å—Ç–æ—Ç—ã DMP (–æ–±—ã—á–Ω–æ 100-200 –ì—Ü). –í—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞ < 1 –º—Å.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞?

**A:** –î–∞! –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –≥—Ä–µ–±–ª—è (—Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ñ–∞–∑—ã: –∑–∞—Ö–≤–∞—Ç, –ø—Ä–æ–≤–æ–¥–∫–∞, –≤—ã–Ω–æ—Å, –∑–∞–Ω–æ—Å)
- SUP (Stand Up Paddle)
- –ö–∞–Ω–æ—ç/–±–∞–π–¥–∞—Ä–∫–∏
- –õ—é–±–æ–π —Å–ø–æ—Ä—Ç —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–º–∏ –¥–≤–∏–∂–µ–Ω–∏—è–º–∏

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ—â–Ω–æ—Å—Ç–∏ –º–æ—Ç–æ—Ä–∞ –ø–æ —Ñ–∞–∑–µ:

```cpp
void SmartKayak::update() {
    // ... –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ ...
    
    StrokePhase::Phase phase = orientationEstimator.getCurrentPhase();
    float confidence = orientationEstimator.getPhaseConfidence();
    
    int motorForce = calculateBaseForce();  // –í–∞—à–∞ –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    
    // –ú–æ–¥—É–ª—è—Ü–∏—è –ø–æ —Ñ–∞–∑–µ
    if (phase == StrokePhase::PULL && confidence > 0.7f) {
        motorForce *= 1.2f;  // +20% –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–æ–¥–∫–∏
    } else if (phase == StrokePhase::RECOVERY) {
        motorForce *= 0.5f;  // –°–Ω–∏–∂–∞–µ–º –≤–æ –≤—Ä–µ–º—è –≤–æ–∑–≤—Ä–∞—Ç–∞
    }
    
    motorDriver->setForce(motorForce);
}
```

### –ü—Ä–∏–º–µ—Ä 2: –î–µ—Ç–µ–∫—Ü–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏:

```cpp
void analyzePaddleTechnique() {
    static int consecutiveBadStrokes = 0;
    
    StrokePhase::Phase phase = orientationEstimator.getCurrentPhase();
    float confidence = orientationEstimator.getPhaseConfidence();
    
    if (confidence < 0.5f) {
        consecutiveBadStrokes++;
        
        if (consecutiveBadStrokes > 5) {
            Serial.println("‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –≥—Ä–µ–±–ª–∏!");
            // –í–∏–±—Ä–∞—Ü–∏—è, –∑–≤—É–∫, –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–ø–ª–µ–π
        }
    } else {
        consecutiveBadStrokes = 0;
    }
}
```

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞:
1. "Sensor Fusion and Tracking with Modern Applications" - L. Liggins
2. "Quaternions for Computer Graphics" - J. Vince
3. "Applied Optimal Estimation" - MIT Press (Kalman Filters)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- **MagMaster** - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞–≥–Ω–∏—Ç–Ω–æ–≥–æ –ø–æ–ª—è
- **Madgwick/Mahony Filter** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ñ—É–∑–∏–∏
- **Python scipy** - –¥–ª—è –æ—Ñ–ª–∞–π–Ω –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

–≠—Ç–æ—Ç –∫–æ–¥ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø—Ä–æ–µ–∫—Ç–∞ SmartKayak.
–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ Issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

**–£–¥–∞—á–∏ —Å –≤–∞—à–∏–º —É–º–Ω—ã–º –∫–∞—è–∫–æ–º! üö£‚Äç‚ôÇÔ∏è**
