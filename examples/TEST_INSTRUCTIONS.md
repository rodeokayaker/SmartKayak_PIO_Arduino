# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é StrokePredictorGrid

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞

```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
pio run -e test_grid_predictor_esp32

# –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ ESP32
pio run -e test_grid_predictor_esp32 -t upload

# –û—Ç–∫—Ä—ã—Ç—å Serial Monitor
pio device monitor -e test_grid_predictor_esp32
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ PlatformIO IDE:
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ VSCode/PlatformIO
2. –í—ã–±—Ä–∞—Ç—å environment: **test_grid_predictor_esp32**
3. –ù–∞–∂–∞—Ç—å **Build** (–≥–∞–ª–æ—á–∫–∞ –≤–Ω–∏–∑—É)
4. –ù–∞–∂–∞—Ç—å **Upload** (—Å—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ)
5. –ù–∞–∂–∞—Ç—å **Monitor** (—Ä–æ–∑–µ—Ç–∫–∞)

---

## –ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å

### –§–∞–∑–∞ 1: –ì—Ä–µ–±–∫–∏ 1-3 (—á–µ—Ä–µ–∑ 3 —Å–µ–∫) - –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- 3 –≥—Ä–µ–±–∫–∞ –ø–æ 1 —Å–µ–∫—É–Ω–¥–µ –∫–∞–∂–¥—ã–π (20 —Å–µ–º–ø–ª–æ–≤ –ø–æ 50–º—Å)
- –û–±—É—á–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å–∏–ª—ã —á–µ—Ä–µ–∑ 200–º—Å –≤–æ –≤—Ä–µ–º—è –≥—Ä–µ–±–∫–∞
- –í—ã–≤–æ–¥: —É–≥–ª—ã, —Å–∏–ª—ã, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–∫–∏ –ø–æ—Å–ª–µ 3 –≥—Ä–µ–±–∫–æ–≤

### –§–∞–∑–∞ 2: –ì—Ä–µ–±–∫–∏ 4-6 (—á–µ—Ä–µ–∑ 6 —Å–µ–∫) - –ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
- –ï—â–µ 3 –≥—Ä–µ–±–∫–∞
- –°–µ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —É—á–∏—Ç—å—Å—è
- –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ 6 –≥—Ä–µ–±–∫–æ–≤

### –§–∞–∑–∞ 3: –ì—Ä–µ–±–∫–∏ 7-10 (—á–µ—Ä–µ–∑ 9 —Å–µ–∫) - –£—Ç–æ—á–Ω–µ–Ω–∏–µ
- –§–∏–Ω–∞–ª—å–Ω—ã–µ 4 –≥—Ä–µ–±–∫–∞ (–≤—Å–µ–≥–æ 10)
- –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ 10 –≥—Ä–µ–±–∫–æ–≤

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—á–µ—Ä–µ–∑ 12 —Å–µ–∫)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–æ–∂–µ–Ω–∏—è—Ö
- –î–≤–∞ —Ä–µ–∂–∏–º–∞:
  - **–¢–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ** (deltaT=0): –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
  - **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 200–º—Å**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å—Ç—Ä–∞–ø–æ–ª—è—Ü–∏–∏
- –£–≥–ª—ã: 0¬∞, 15¬∞, 30¬∞, 45¬∞, 60¬∞

### –§–∞–∑–∞ 5: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—á–µ—Ä–µ–∑ 15 —Å–µ–∫)
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä–µ–±–∫–æ–≤: 10
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ learn/predict
- –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å–µ—Ç–∫–∏
- –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
- –î–∏–∞–ø–∞–∑–æ–Ω—ã —Å–∏–ª
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –§–∞–∑–∞ 6: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- **'r'** - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π —Å–µ—Ç–∫–∏
- **'s'** - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- **'a'** - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –º–µ—Ç–æ–¥ –æ–±—É—á–µ–Ω–∏—è A
- **'b'** - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –º–µ—Ç–æ–¥ –æ–±—É—á–µ–Ω–∏—è B

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–æ—Å–ª–µ 10 –≥—Ä–µ–±–∫–æ–≤:
```
=== Grid Statistics ===
Filled cells: 28-35
Average confidence: 45-55
Grid step: 10.0 degrees
Alpha EMA: 0.20
Force threshold: 400.0
Learning method: METHOD_B
Force forward range: 0 .. 1000
Force backward range: 0 .. 0
Confidence range: 30 .. 70
Memory used: ~1 KB
=======================
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –≤–æ –≤—Ä–µ–º—è –≥—Ä–µ–±–∫–∞:
```
Step 5: angle=25.0¬∞, force=866.0, predicted=750.0, conf=0.25
Step 10: angle=50.0¬∞, force=1000.0, predicted=920.0, conf=0.45
Step 15: angle=75.0¬∞, force=259.0, predicted=180.0, conf=0.38
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
Testing without time offset (current position):
  0.0¬∞ (Vertical): force=0-100, conf=0.20-0.40
  15.0¬∞ (Early stroke): force=400-600, conf=0.30-0.50
  30.0¬∞ (Mid stroke): force=700-900, conf=0.40-0.60
  45.0¬∞ (Late stroke): force=100-300, conf=0.30-0.50
  60.0¬∞ (End stroke): force=0-50, conf=0.10-0.30

Testing with 200ms prediction:
  (–ó–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –∏–∑-–∑–∞ —ç–∫—Å—Ç—Ä–∞–ø–æ–ª—è—Ü–∏–∏)
```

---

## –ö–æ–º–∞–Ω–¥—ã Serial Monitor

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
- **r** –∏–ª–∏ **R** - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π —Å–µ—Ç–∫–∏

---

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `examples/test_stroke_predictor_grid.cpp`, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `setup()`:

```cpp
// –ò–∑–º–µ–Ω–∏—Ç—å —à–∞–≥ —Å–µ—Ç–∫–∏ (5-20¬∞)
predictor.config.gridStep = 15.0f;

// –ò–∑–º–µ–Ω–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è (0.1-0.5)
predictor.config.alphaEMA = 0.3f;

// –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä–æ–≥ —Å–∏–ª—ã (–≥—Ä–∞–º–º—ã)
predictor.config.forceThreshold = 300.0f;

// –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (–º—Å)
predictor.config.predictionTime = 250.0f;

// –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–µ—Ç–æ–¥ –æ–±—É—á–µ–Ω–∏—è
predictor.learningMethod = LearningMethod::METHOD_A;
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
pio run -e test_grid_predictor_esp32 -t upload
```

---

## –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è:
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
pio run -e test_grid_predictor_esp32 -t clean
pio run -e test_grid_predictor_esp32
```

### –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–Ω–æ –≤—ã–≤–æ–¥–∞ –≤ Serial:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å: 115200 baud
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É RESET –Ω–∞ ESP32
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç: `/dev/cu.usbserial-0001` (macOS) –∏–ª–∏ `COM*` (Windows)

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏:
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `platformio.ini`:
```ini
[env:test_grid_predictor_esp32]
upload_port = /dev/cu.usbserial-XXXX  # –í–∞—à –ø–æ—Ä—Ç
```

–ù–∞–π—Ç–∏ –ø–æ—Ä—Ç:
```bash
pio device list
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ù–∞ ESP32 @ 240MHz –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è**: ~40-60 –º–∫—Å –Ω–∞ —Å–µ–º–ø–ª
- **–í—Ä–µ–º—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è**: ~50-80 –º–∫—Å
- **–ù–∞–≥—Ä—É–∑–∫–∞ CPU**: < 1% –ø—Ä–∏ 100Hz
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: 
  - –ù–∞—á–∞–ª–æ: ~160 –±–∞–π—Ç
  - –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞: ~5-10 –ö–ë

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ SmartKayak (—Å–º. `INTEGRATION_EXAMPLE.md`)
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é –≥—Ä–µ–±–ª—é
4. –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä–æ–º

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: `espressif32 >= 6.0.0`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ `platformio.ini`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª `test_stroke_predictor_grid.cpp` –≤ –ø–∞–ø–∫–µ `examples/`
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª—ã `StrokePredictorGrid.h/.cpp` –≤ `lib/SmartKayak/`

**–£—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!** üöÄ

